<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Safety Huddle Local</title>
  <style>
    /* Seu estilo original aqui ou link externo */
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 15px;
    }
    th, td {
      border: 1px solid #999;
      padding: 8px;
      text-align: left;
    }
    th {
      background: #eee;
    }
    .container {
      max-width: 900px;
      margin: auto;
    }
    input[type="text"], input[type="number"], input[type="date"] {
      width: 90%;
      padding: 5px;
      box-sizing: border-box;
    }
    input[type="radio"] {
      margin-left: 15px;
    }
    .checkbox-group label {
      margin-right: 10px;
      display: inline-block;
    }
    .rodape {
      margin-top: 20px;
      font-size: 0.9em;
      color: #555;
    }
  </style>
</head>
<body>

<div class="container">
  <h2>Safety Huddle Local</h2>

  <div class="top">
    <label>Data: <input type="date" id="data" /></label>
    <label>Tempo Gasto: <input type="number" min="0" id="tempo" /> min</label>
  </div>

  <div class="checkbox-group">
    <strong>Equipe do Huddle:</strong><br />
    <label><input type="checkbox" id="enfermeiros" /> Enfermeiros</label>
    <label><input type="checkbox" id="fisioterapeuta" /> Fisioterapeuta</label>
    <label><input type="checkbox" id="nutricionistas" /> Nutricionistas</label>
    <label><input type="checkbox" id="tecnicos" /> Técnicos</label>
    <label><input type="checkbox" id="auxiliares" /> Auxiliares</label>
  </div>

  <div class="info">
    <label>Número de Leitos Ocupados: <input type="text" id="leitosOcupados" /></label>
    <label>Previsões de Alta: <input type="text" id="previsoesAlta" /></label>
    <label>Leitos interditados: <input type="text" id="leitosInterditados" /></label>
    <label>Contingência/leitos extras: <input type="text" id="contingencia" /></label>
  </div>

  <table>
    <thead>
      <tr>
        <th style="width: 30%">Pergunta</th>
        <th>Não</th>
        <th>Sim</th>
        <th>Quais?</th>
        <th>Devolutiva do caso para a equipe</th>
      </tr>
    </thead>
    <tbody>
      <!-- Perguntas: mantém os IDs para salvar corretamente -->
      <tr>
        <td>1. Paciente com gerenciamento de risco (farol amarelo ou vermelho)?</td>
        <td><input type="radio" name="q1" value="nao" /></td>
        <td><input type="radio" name="q1" value="sim" /></td>
        <td><input type="text" id="q1_quais" /></td>
        <td><input type="text" id="q1_devolutiva" /></td>
      </tr>
      <tr>
        <td>2. Paciente “Whatcher” (seriamente preocupado, críticos ou instáveis?)</td>
        <td><input type="radio" name="q2" value="nao" /></td>
        <td><input type="radio" name="q2" value="sim" /></td>
        <td><input type="text" id="q2_quais" /></td>
        <td><input type="text" id="q2_devolutiva" /></td>
      </tr>
      <tr>
        <td>3. Pacientes com alto risco de queda, resistentes às orientações e não aderente às medidas preventivas ou sem acompanhante?</td>
        <td><input type="radio" name="q3" value="nao" /></td>
        <td><input type="radio" name="q3" value="sim" /></td>
        <td><input type="text" id="q3_quais" /></td>
        <td><input type="text" id="q3_devolutiva" /></td>
      </tr>
      <tr>
        <td>4. Pacientes com alto risco LP? Resistente às medidas preventivas?</td>
        <td><input type="radio" name="q4" value="nao" /></td>
        <td><input type="radio" name="q4" value="sim" /></td>
        <td><input type="text" id="q4_quais" /></td>
        <td><input type="text" id="q4_devolutiva" /></td>
      </tr>
      <tr>
        <td>5. Divergências entre o plano terapêutico?</td>
        <td><input type="radio" name="q5" value="nao" /></td>
        <td><input type="radio" name="q5" value="sim" /></td>
        <td><input type="text" id="q5_quais" /></td>
        <td><input type="text" id="q5_devolutiva" /></td>
      </tr>
      <tr>
        <td>6. Terapias, procedimentos, protocolos ou dispositivos de alto risco ou não habituais?</td>
        <td><input type="radio" name="q6" value="nao" /></td>
        <td><input type="radio" name="q6" value="sim" /></td>
        <td><input type="text" id="q6_quais" /></td>
        <td><input type="text" id="q6_devolutiva" /></td>
      </tr>
      <tr>
        <td>7. Houve a ocorrência de procedimentos invasivos não planejados ou situações de emergências?</td>
        <td><input type="radio" name="q7" value="nao" /></td>
        <td><input type="radio" name="q7" value="sim" /></td>
        <td><input type="text" id="q7_quais" /></td>
        <td><input type="text" id="q7_devolutiva" /></td>
      </tr>
      <tr>
        <td>8. Eventos Adversos?</td>
        <td><input type="radio" name="q8" value="nao" /></td>
        <td><input type="radio" name="q8" value="sim" /></td>
        <td><input type="text" id="q8_quais" /></td>
        <td><input type="text" id="q8_devolutiva" /></td>
      </tr>
      <tr>
        <td>9. Problemas com infraestrutura, Cerner, equipamentos, materiais ou medicamentos?</td>
        <td><input type="radio" name="q9" value="nao" /></td>
        <td><input type="radio" name="q9" value="sim" /></td>
        <td><input type="text" id="q9_quais" /></td>
        <td><input type="text" id="q9_devolutiva" /></td>
      </tr>
      <tr>
        <td>10. Algum paciente elegível para a visita multiprofissional ou discussão do time diagnóstico?</td>
        <td><input type="radio" name="q10" value="nao" /></td>
        <td><input type="radio" name="q10" value="sim" /></td>
        <td><input type="text" id="q10_quais" /></td>
        <td><input type="text" id="q10_devolutiva" /></td>
      </tr>
      <tr>
        <td>11. Outros:</td>
        <td><input type="radio" name="q11" value="nao" /></td>
        <td><input type="radio" name="q11" value="sim" /></td>
        <td><input type="text" id="q11_quais" /></td>
        <td><input type="text" id="q11_devolutiva" /></td>
      </tr>
    </tbody>
  </table>

  <p class="rodape">
    *Fluxo de Escalonamento: Horário comercial comunicar sênior e Coordenador. Período noturno comunicar sênior e/ou supervisor administrativo. Nos finais de semana comunicar coordenador da área, não conseguindo contato acionar direto supervisor administrativo.
  </p>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // Configuração Firebase (substitua pelos seus dados)
  const firebaseConfig = {
    apiKey: "SUA_API_KEY_AQUI",
    authDomain: "SEU_AUTH_DOMAIN.firebaseapp.com",
    databaseURL: "https://SEU_DATABASE_URL.firebaseio.com",
    projectId: "SEU_PROJECT_ID",
    storageBucket: "SEU_STORAGE_BUCKET.appspot.com",
    messagingSenderId: "SEU_MESSAGING_SENDER_ID",
    appId: "SEU_APP_ID"
  };

  // Inicializa Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const rootNode = "safety-huddle";

  // Função para salvar os dados do formulário no Firebase
  function salvarDados() {
    const dataObj = {};

    // Salvar inputs simples
    dataObj.data = document.getElementById("data").value;
    dataObj.tempo = document.getElementById("tempo").value;

    // Checkbox equipe
    dataObj.equipe = {
      enfermeiros: document.getElementById("enfermeiros").checked,
      fisioterapeuta: document.getElementById("fisioterapeuta").checked,
      nutricionistas: document.getElementById("nutricionistas").checked,
      tecnicos: document.getElementById("tecnicos").checked,
      auxiliares: document.getElementById("auxiliares").checked,
    };

    // Inputs info
    dataObj.leitosOcupados = document.getElementById("leitosOcupados").value;
    dataObj.previsoesAlta = document.getElementById("previsoesAlta").value;
    dataObj.leitosInterditados = document.getElementById("leitosInterditados").value;
    dataObj.contingencia = document.getElementById("contingencia").value;

    // Perguntas (1 a 11)
    dataObj.perguntas = {};
    for(let i=1; i<=11; i++) {
      const respRadio = document.querySelector(`input[name="q${i}"]:checked`);
      dataObj.perguntas[`q${i}`] = {
        resposta: respRadio ? respRadio.value : "",
        quais: document.getElementById(`q${i}_quais`).value,
        devolutiva: document.getElementById(`q${i}_devolutiva`).value
      };
    }

    // Salva no Firebase (usando pushId ou pode salvar direto)
    db.ref(rootNode).set(dataObj)
      .then(() => {
        console.log("Dados salvos com sucesso!");
      })
      .catch((error) => {
        console.error("Erro ao salvar dados:", error);
      });
  }

  // Função para carregar dados do Firebase e preencher o formulário
  function carregarDados() {
    db.ref(rootNode).get().then((snapshot) => {
      if(snapshot.exists()) {
        const dataObj = snapshot.val();

        document.getElementById("data").value = dataObj.data || "";
        document.getElementById("tempo").value = dataObj.tempo || "";

        // Checkboxes
        document.getElementById("enfermeiros").checked = dataObj.equipe?.enfermeiros || false;
        document.getElementById("fisioterapeuta").checked = dataObj.equipe?.fisioterapeuta || false;
        document.getElementById("nutricionistas").checked = dataObj.equipe?.nutricionistas || false;
        document.getElementById("tecnicos").checked = dataObj.equipe?.tecnicos || false;
        document.getElementById("auxiliares").checked = dataObj.equipe?.auxiliares || false;

        // Inputs info
        document.getElementById("leitosOcupados").value = dataObj.leitosOcupados || "";
        document.getElementById("previsoesAlta").value = dataObj.previsoesAlta || "";
        document.getElementById("leitosInterditados").value = dataObj.leitosInterditados || "";
        document.getElementById("contingencia").value = dataObj.contingencia || "";

        // Perguntas
        for(let i=1; i<=11; i++) {
          const resposta = dataObj.perguntas?.[`q${i}`]?.resposta;
          if(resposta) {
            const radio = document.querySelector(`input[name="q${i}"][value="${resposta}"]`);
            if(radio) radio.checked = true;
          }
          document.getElementById(`q