<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Safety Huddle Local</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .container {
      max-width: 1000px;
      margin: auto;
    }
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    th, td {
      padding: 6px;
      text-align: left;
    }
    .top input, .info input, table input {
      margin: 4px;
    }
    .checkbox-group label {
      margin-right: 10px;
    }
    .rodape {
      margin-top: 20px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container" id="formulario">
    <h2>Safety Huddle Local</h2>
    <div class="top">
      <label>Data: <input type="date" id="data"></label>
      <label>Hora: <input type="time" id="hora"></label>
      <label>Tempo Gasto Minutos:<input type="number" min="0" id="tempo"></label>
      <button onclick="gerarPDF()">Salvar PDF</button>
    </div>

    <div class="checkbox-group">
      <strong>Equipe do Huddle:</strong><br>
      <label><input type="checkbox" id="enf"> Enfermeiros</label>
      <label><input type="checkbox" id="fisio"> Fisioterapeuta</label>
      <label><input type="checkbox" id="nutri"> Nutricionistas</label>
      <label><input type="checkbox" id="tec"> T√©cnicos</label>
      <label><input type="checkbox" id="aux"> Auxiliares</label>
    </div>

    <div class="info">
      <label>N√∫mero de Leitos Ocupados: <input type="text" id="leitos"></label>
      <label>Previs√µes de Alta: <input type="text" id="altas"></label>
      <label>Leitos interditados: <input type="text" id="interditados"></label>
    </div>

    <table id="tabela">
      <thead>
        <tr>
          <th>Pergunta</th>
          <th>N√£o</th>
          <th>Sim</th>
          <th>Quais?</th>
          <th>Devolutiva</th>
        </tr>
      </thead>
      <tbody>
        <!-- 11 perguntas -->
        <script>
          const perguntas = [
            "1. Paciente com gerenciamento de risco (farol amarelo ou vermelho)?",
            "2. Paciente 'Whatcher' (seriamente preocupado, cr√≠ticos ou inst√°veis?)",
            "3. Pacientes com alto risco de queda?",
            "4. Pacientes com alto risco LP?",
            "5. Diverg√™ncias entre o plano terap√™utico?",
            "6. Terapias, procedimentos ou dispositivos de alto risco?",
            "7. Procedimentos invasivos n√£o planejados?",
            "8. Eventos Adversos?",
            "9. Problemas com infraestrutura, Cerner, equipamentos?",
            "10. Paciente eleg√≠vel para visita multiprofissional?",
            "11. Outros:"
          ];
          document.write(perguntas.map((pergunta, i) => `
            <tr>
              <td>${pergunta}</td>
              <td><input type="radio" name="q${i}" value="nao"></td>
              <td><input type="radio" name="q${i}" value="sim"></td>
              <td><input type="text" id="q${i}_quais"></td>
              <td><input type="text" id="q${i}_dev"></td>
            </tr>
          `).join(''));
        </script>
      </tbody>
    </table>

    <p class="rodape">
      *Fluxo de Escalonamento: Hor√°rio comercial comunicar s√™nior e Coordenador. Per√≠odo noturno comunicar s√™nior e/ou supervisor administrativo. Nos finais de semana comunicar coordenador da √°rea, n√£o conseguindo contato acionar direto supervisor administrativo.
    </p>
  </div>

  <script>
    // üîß Substitua com as suas chaves do Firebase
    const firebaseConfig = {
      apiKey: "SUA_API_KEY",
      authDomain: "SEU_PROJETO.firebaseapp.com",
      databaseURL: "https://SEU_PROJETO.firebaseio.com",
      projectId: "SEU_PROJETO",
      storageBucket: "SEU_PROJETO.appspot.com",
      messagingSenderId: "SENDER_ID",
      appId: "APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const campos = [
      "data", "hora", "tempo", "leitos", "altas", "interditados",
      "enf", "fisio", "nutri", "tec", "aux"
    ];

    campos.forEach(id => {
      const el = document.getElementById(id);
      el.addEventListener("change", () => {
        const val = el.type === "checkbox" ? el.checked : el.value;
        db.ref("form/" + id).set(val);
      });
      db.ref("form/" + id).on("value", snap => {
        if (snap.exists()) {
          if (el.type === "checkbox") el.checked = snap.val();
          else el.value = snap.val();
        }
      });
    });

    for (let i = 0; i < 11; i++) {
      ["q" + i + "_quais", "q" + i + "_dev"].forEach(id => {
        const el = document.getElementById(id);
        el.addEventListener("input", () => {
          db.ref("form/" + id).set(el.value);
        });
        db.ref("form/" + id).on("value", snap => {
          if (snap.exists()) el.value = snap.val();
        });
      });

      const radios = document.getElementsByName("q" + i);
      radios.forEach(radio => {
        radio.addEventListener("change", () => {
          if (radio.checked) {
            db.ref("form/q" + i + "_radio").set(radio.value);
          }
        });
      });

      db.ref("form/q" + i + "_radio").on("value", snap => {
        if (snap.exists()) {
          radios.forEach(r => r.checked = (r.value === snap.val()));
        }
      });
    }

    function gerarPDF() {
      const element = document.getElementById("formulario");
      const opt = {
        margin: 0.5,
        filename: 'safety-huddle.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'cm', format: 'a4', orientation: 'portrait' }
      };
      html2pdf().set(opt).from(element).save();
    }
  </script>
</body>
</html>