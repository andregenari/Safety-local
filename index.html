<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Safety Huddle Local</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  .container { max-width: 900px; margin: auto; }
  table { border-collapse: collapse; width: 100%; margin-top: 20px; }
  th, td { border: 1px solid #ddd; padding: 8px; vertical-align: top; }
  th { background: #f2f2f2; }
  label { display: inline-block; margin: 5px 10px 10px 0; }
  input[type="text"], input[type="number"], input[type="date"], input[type="time"] {
    width: 150px;
  }
  .checkbox-group label { margin-right: 15px; }
  .rodape { margin-top: 30px; font-size: 0.85em; color: #555; }
  #btnPdf { margin-left: 15px; padding: 6px 12px; }
</style>
</head>
<body>
<div class="container" id="form-container">
  <h2>Safety Huddle Local</h2>
  <div class="top">
    <label>Data: <input type="date" id="data" /></label>
    <label>Hora: <input type="time" id="hora" /></label>
    <label>Tempo Gasto Minutos: <input type="number" id="tempo" min="0" /></label>
    <button id="btnPdf">Salvar PDF</button>
  </div>

  <div class="checkbox-group">
    <strong>Equipe do Huddle:</strong><br />
    <label><input type="checkbox" id="enfermeiros" /> Enfermeiros</label>
    <label><input type="checkbox" id="fisioterapeuta" /> Fisioterapeuta</label>
    <label><input type="checkbox" id="nutricionistas" /> Nutricionistas</label>
    <label><input type="checkbox" id="tecnicos" /> Técnicos</label>
    <label><input type="checkbox" id="auxiliares" /> Auxiliares</label>
  </div>

  <div class="info">
    <label>Número de Leitos Ocupados: <input type="text" id="leitos" /></label>
    <label>Previsões de Alta: <input type="text" id="previsoes" /></label>
    <label>Leitos interditados: <input type="text" id="interditados" /></label>
  </div>

  <table>
    <thead>
      <tr>
        <th style="width: 30%">Pergunta</th>
        <th>Não</th>
        <th>Sim</th>
        <th>Quais?</th>
        <th>Devolutiva do caso para a equipe</th>
      </tr>
    </thead>
    <tbody>
      <!-- Perguntas de 1 a 11 -->
      ${[...Array(11).keys()].map(i => {
        const n = i+1;
        return `
        <tr>
          <td>${n}. Pergunta ${n}?</td>
          <td><input type="radio" name="q${n}" value="nao" /></td>
          <td><input type="radio" name="q${n}" value="sim" /></td>
          <td><input type="text" id="q${n}_quais" /></td>
          <td><input type="text" id="q${n}_devolutiva" /></td>
        </tr>
        `;
      }).join('')}
    </tbody>
  </table>

  <p class="rodape">
    *Fluxo de Escalonamento: Horário comercial comunicar sênior e Coordenador. Período noturno comunicar sênior e/ou supervisor administrativo. Nos finais de semana comunicar coordenador da área, não conseguindo contato acionar direto supervisor administrativo.
  </p>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
  // Configuração do Firebase - use as suas chaves aqui
  const firebaseConfig = {
    apiKey: "AIzaSyBLmbarQp31Sqs0_VsYdE-OWdUlYO4WT7M",
    authDomain: "safety-leste.firebaseapp.com",
    databaseURL: "https://safety-leste-default-rtdb.firebaseio.com",
    projectId: "safety-leste",
    storageBucket: "safety-leste.firebasestorage.app",
    messagingSenderId: "922824064168",
    appId: "1:922824064168:web:d89c1c2fc24860b2cbd69d",
    measurementId: "G-G59DD5DB64"
  };

  // Inicializa Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // Referência no DB
  const ref = db.ref('safety-huddle');

  // IDs de inputs para carregar/salvar
  const camposSimples = ['data','hora','tempo','leitos','previsoes','interditados'];
  const checkboxes = ['enfermeiros','fisioterapeuta','nutricionistas','tecnicos','auxiliares'];
  const perguntas = [];
  for(let i=1; i<=11; i++){
    perguntas.push(`q${i}`);
    perguntas.push(`q${i}_quais`);
    perguntas.push(`q${i}_devolutiva`);
  }

  // Função para salvar campo simples (input text, number, date, time)
  function salvarCampoSimples(id, valor) {
    ref.child(id).set(valor);
  }
  // Função para salvar checkbox
  function salvarCheckbox(id, valor) {
    ref.child(id).set(valor);
  }
  // Função para salvar radio button (pergunta)
  function salvarRadio(nome, valor) {
    ref.child(nome).set(valor);
  }

  // Atualiza os inputs a partir do DB
  function atualizarCampos(data) {
    if(!data) return;

    // Campos simples
    camposSimples.forEach(id => {
      if(data[id] !== undefined) {
        document.getElementById(id).value = data[id];
      }
    });

    // Checkboxes
    checkboxes.forEach(id => {
      if(data[id] !== undefined) {
        document.getElementById(id).checked = data[id];
      }
    });

    // Perguntas
    for(let i=1; i<=11; i++) {
      if(data[`q${i}`] !== undefined) {
        const radios = document.getElementsByName(`q${i}`);
        radios.forEach(radio => {
          radio.checked = (radio.value === data[`q${i}`]);
        });
      }
      if(data[`q${i}_quais`] !== undefined) {
        document.getElementById(`q${i}_quais`).value = data[`q${i}_quais`];
      }
      if(data[`q${i}_devolutiva`] !== undefined) {
        document.getElementById(`q${i}_devolutiva`).value = data[`q${i}_devolutiva`];
      }
    }
  }

  // Escuta mudanças no DB e atualiza a página em tempo real
  ref.on('value', snapshot => {
    atualizarCampos(snapshot.val());
  });

  // Configura eventos para salvar dados ao alterar cada campo
  // Campos simples
  camposSimples.forEach(id => {
    const el = document.getElementById(id);
    el.addEventListener('input', e => salvarCampoSimples(id, e.target.value));
  });

  // Checkboxes
  checkboxes.forEach(id => {
    const el = document.getElementById(id);
    el.addEventListener('change', e => salvarCheckbox(id, e.target.checked));
  });

  // Radios (perguntas)
  for(let i=1; i<=11; i++) {
    const radios = document.getElementsByName(`q${i}`);
    radios.forEach(radio => {
      radio.addEventListener('change', e => {
        if(e.target.checked) {
          salvarRadio(`q${i}`, e.target.value);
        }
      });
    });
  }

  // Textos "quais"