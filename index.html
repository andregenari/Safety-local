document.addEventListener("DOMContentLoaded", () => {
  // Função que salva todos os inputs e radios da tabela no localStorage
  function saveData() {
    const tbody = document.querySelector("table tbody");
    const data = [];
    tbody.querySelectorAll("tr").forEach((tr, index) => {
      const cells = tr.querySelectorAll("td");
      const radiosNao = cells[1].querySelector("input[type=radio]");
      const radiosSim = cells[2].querySelector("input[type=radio]");
      const quais = cells[3].querySelector("input").value;
      const devolutiva = cells[4].querySelector("input").value;

      data[index] = {
        naoChecked: radiosNao.checked,
        simChecked: radiosSim.checked,
        quais,
        devolutiva
      };
    });
    localStorage.setItem("safetyHuddleData", JSON.stringify(data));
  }

  // Função que carrega os dados do localStorage e preenche a tabela
  function loadData() {
    const dataStr = localStorage.getItem("safetyHuddleData");
    if (!dataStr) return;
    const data = JSON.parse(dataStr);
    const tbody = document.querySelector("table tbody");
    tbody.querySelectorAll("tr").forEach((tr, index) => {
      const cells = tr.querySelectorAll("td");
      if (!data[index]) return;
      const radiosNao = cells[1].querySelector("input[type=radio]");
      const radiosSim = cells[2].querySelector("input[type=radio]");
      const quais = cells[3].querySelector("input");
      const devolutiva = cells[4].querySelector("input");

      radiosNao.checked = data[index].naoChecked;
      radiosSim.checked = data[index].simChecked;
      quais.value = data[index].quais;
      devolutiva.value = data[index].devolutiva;
    });
  }

  // Chamar loadData no carregamento da página
  loadData();

  // Adicionar listeners para salvar ao alterar qualquer input ou radio da tabela
  const tbody = document.querySelector("table tbody");
  tbody.querySelectorAll("input").forEach(input => {
    input.addEventListener("change", saveData);
  });
});